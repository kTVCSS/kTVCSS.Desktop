# Руководство по автообновлениям kTVCSS Desktop

## Настройка автообновлений

Автообновления настроены для работы через GitHub Releases. Приложение автоматически проверяет наличие новых версий и предлагает их установить.

## Как создать новый релиз

### 1. Подготовка

Убедитесь, что у вас установлены все зависимости:
```bash
npm install
```

### 2. Обновление версии

Перед созданием релиза обновите версию в `package.json`:
```json
{
  "version": "1.0.1"  // Увеличьте версию (например, с 1.0.0 до 1.0.1)
}
```

### 3. Создание GitHub Personal Access Token

Для публикации релизов на GitHub нужен токен доступа:

1. Перейдите в GitHub → Settings → Developer settings → Personal access tokens → Tokens (classic)
2. Нажмите "Generate new token (classic)"
3. Дайте токену имя (например, "kTVCSS Desktop Releases")
4. Выберите права доступа:
   - `repo` (полный доступ к репозиториям)
5. Создайте токен и скопируйте его (он показывается только один раз!)

### 4. Установка токена

**Windows (PowerShell):**
```powershell
$env:GH_TOKEN="ваш_токен_здесь"
```

**Windows (CMD):**
```cmd
set GH_TOKEN=ваш_токен_здесь
```

**Linux/Mac:**
```bash
export GH_TOKEN="ваш_токен_здесь"
```

**Для постоянной установки (Windows):**
- Откройте "Система" → "Дополнительные параметры системы" → "Переменные среды"
- Добавьте новую переменную `GH_TOKEN` со значением вашего токена

### 5. Сборка и публикация релиза

Выполните команду для сборки и автоматической публикации на GitHub:

```bash
npm run build
```

Или явно указать публикацию:
```bash
electron-builder --publish always
```

Это создаст:
- Установщик в папке `dist/`
- Автоматически создаст GitHub Release с тегом версии
- Загрузит установщик как asset в релиз

### 6. Проверка релиза

1. Перейдите на https://github.com/kTVCSS/kTVCSS.Desktop/releases
2. Убедитесь, что новый релиз создан
3. Проверьте, что установщик загружен в assets

## Как работает автообновление

1. **При запуске приложения** (через 5 секунд после запуска):
   - Приложение проверяет наличие обновлений на GitHub Releases
   - Если найдена новая версия, она автоматически загружается

2. **Периодическая проверка** (каждые 4 часа):
   - Приложение автоматически проверяет обновления в фоновом режиме

3. **Установка обновления**:
   - После загрузки обновление устанавливается при следующем запуске приложения
   - Или можно установить сразу (если настроено в коде)

## Структура версий

Версии должны следовать семантическому версионированию:
- `1.0.0` - первая версия
- `1.0.1` - патч (исправления багов)
- `1.1.0` - минорная версия (новые функции)
- `2.0.0` - мажорная версия (критические изменения)

## Важные замечания

1. **Токен безопасности**: Никогда не коммитьте токен в репозиторий! Используйте переменные окружения.

2. **Версия в package.json**: Версия в `package.json` должна совпадать с версией тега на GitHub.

3. **Тестирование**: Перед публикацией релиза протестируйте установщик локально.

4. **Changelog**: Рекомендуется добавлять описание изменений в GitHub Release.

## Автоматизация через GitHub Actions (опционально)

Можно настроить автоматическую сборку и публикацию через GitHub Actions. Создайте файл `.github/workflows/release.yml`:

```yaml
name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm install
      - run: npm run build
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
```

Затем добавьте `GH_TOKEN` в Secrets репозитория (Settings → Secrets and variables → Actions).

## Устранение проблем

**Проблема**: Ошибка "GitHub Releases: 401 Unauthorized"
- **Решение**: Проверьте, что токен установлен правильно и имеет права `repo`

**Проблема**: Ошибка "GitHub Releases: 404 Not Found"
- **Решение**: Убедитесь, что owner и repo в `package.json` указаны правильно

**Проблема**: Обновления не находятся
- **Решение**: Проверьте, что версия в `package.json` больше текущей установленной версии

